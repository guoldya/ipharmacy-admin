<template>
  <div class="drugDetail">
    <a-card style="background-color: #f7fcff">
      <a-row>
        <a-col :md="6" :lg="3" class="font-bold fontSize">珍珠降压片</a-col>
        <a-col :md="6" :lg="4" style="line-height: 36px">
          <a-tag style="cursor: default;"> 保</a-tag>
          <span class="opacity8">国家医保目录（乙类）</span>
        </a-col>
      </a-row>
      <a-row class="margin-top-10">
        <a-col :md="6" :lg="3">英文名称：zhenzhujiangyapian</a-col>
      </a-row>
    </a-card>
    <a-card class="margin-top-10">
      <a-col :span="4">
        <a-anchor style="text-align: justify;">
          <a-anchor-link href="#drugName" class="w4" title="药品名称"/>
          <a-anchor-link href="#composition" class="w4" title="药品成分"/>
          <a-anchor-link href="#applicableConditions" class="w4" title="适应病症"/>
          <a-anchor-link href="#usage" class="w4" title="用法用量"/>
          <a-anchor-link href="#adverseReactions" class="w4" title="不良反应"/>
          <a-anchor-link href="#taboo" class="w4" title="药品禁忌"/>
          <a-anchor-link href="#mattersAttention" class="w4" title="注意事项"/>
          <a-anchor-link href="#drugInteraction" class="w4" title="相互作用"/>
          <a-anchor-link href="#storage" class="w4" title="药品贮藏"/>
          <a-anchor-link href="#PackingSpec" class="w4" title="包装规格"/>
          <a-anchor-link href="#periodValidity" class="w3" title="有效期"/>
          <a-anchor-link href="#titanic" class="w4" title="批准文号"/>
          <a-anchor-link href="#enterprise" class="w4" title="生产企业"/>
        </a-anchor>
      </a-col>
      <a-col :span="18">
        <div id="drugName">
          <a-row>
            <p class="font-bold">药品名称:</p>
            <p>通用名称：治肾亏不含糖</p>
            <p>英文名称：kidney</p>
            <p>商品名称：六味地黄丸</p>
          </a-row>
          <a-divider></a-divider>
        </div>
        <div id="composition">
          <a-row>
            <p class="font-bold">药品成分</p>
            <p>通用名称：治肾亏不含糖</p>
            <p>英文名称：kidney</p>
            <p>商品名称：六味地黄丸</p>
          </a-row>
          <a-divider></a-divider>
        </div>
        <div id="applicableConditions">
          <a-row>
            <p class="font-bold">适应病症</p>
            <p>通用名称：治肾亏不含糖</p>
            <p>英文名称：kidney</p>
            <p>商品名称：六味地黄丸</p>
          </a-row>
          <a-divider></a-divider>
        </div>
        <div id="usage">
          <a-row>
            <p class="font-bold">用法用量</p>
            <p>通用名称：治肾亏不含糖</p>
            <p>英文名称：kidney</p>
            <p>商品名称：六味地黄丸</p>
          </a-row>
          <a-divider></a-divider>
        </div>
        <div id="adverseReactions">
          <a-row>
            <p class="font-bold">不良反应</p>
            <p>通用名称：治肾亏不含糖</p>
            <p>英文名称：kidney</p>
            <p>商品名称：六味地黄丸</p>
          </a-row>
          <a-divider></a-divider>
        </div>
        <div id="taboo">
          <a-row>
            <p class="font-bold">药品禁忌</p>
            <p>通用名称：治肾亏不含糖</p>
            <p>英文名称：kidney</p>
            <p>商品名称：六味地黄丸</p>
          </a-row>
          <a-divider></a-divider>
        </div>
        <div id="mattersAttention">
          <a-row>
            <p class="font-bold">注意事项</p>
            <p>通用名称：治肾亏不含糖</p>
            <p>英文名称：kidney</p>
            <p>商品名称：六味地黄丸</p>
          </a-row>
          <a-divider></a-divider>
        </div>
        <div id="drugInteraction">
          <a-row>
            <p class="font-bold">相互作用</p>
            <p>通用名称：治肾亏不含糖</p>
            <p>英文名称：kidney</p>
            <p>商品名称：六味地黄丸</p>
          </a-row>
          <a-divider></a-divider>
        </div>
        <div id="storage">
          <a-row>
            <p class="font-bold">药品贮藏</p>
            <p>通用名称：治肾亏不含糖</p>
            <p>英文名称：kidney</p>
            <p>商品名称：六味地黄丸</p>
          </a-row>
          <a-divider></a-divider>
        </div>
        <div id="PackingSpec">
          <a-row>
            <p class="font-bold" >包装规格</p>
            <p>通用名称：治肾亏不含糖</p>
            <p>英文名称：kidney</p>
            <p>商品名称：六味地黄丸</p>
          </a-row>
          <a-divider></a-divider>
        </div>
        <div id="periodValidity">
          <a-row>
            <p class="font-bold">有效期</p>
            <p>通用名称：治肾亏不含糖</p>
            <p>英文名称：kidney</p>
            <p>商品名称：六味地黄丸</p>
          </a-row>
          <a-divider></a-divider>
        </div>
        <div id="titanic">
          <a-row>
            <p class="font-bold">批准文号</p>
            <p>通用名称：治肾亏不含糖</p>
            <p>英文名称：kidney</p>
            <p>商品名称：六味地黄丸</p>
          </a-row>
          <a-divider></a-divider>
        </div>
        <div id="enterprise">
          <a-row>
            <p class="font-bold">生产企业</p>
            <p>通用名称：治肾亏不含糖</p>
            <p>英文名称：kidney</p>
            <p>商品名称：六味地黄丸</p>
          </a-row>
          <a-divider></a-divider>
        </div>
      </a-col>
    </a-card>
  </div>
</template>

<script>
  import { dicPackageSelectOne } from '@/api/login'
  export default {

    name: 'ruleMgt',
    data() {
      return {
        expandedKeys: [],
        searchValue: '',
        autoExpandParent: true,
        gData: [
          {
            key: '0',
            value: '0',
            scopedSlots: { title: 'title' },
            title: '系统规则',
            children: [
              {
                key: '01',
                value: '0',
                type: '1',
                scopedSlots: { title: 'title' },
                title: '药品',
                children: [
                  {
                    key: '011',
                    value: '0',
                    scopedSlots: { title: 'title' },
                    title: '中成药'
                  },
                  {
                    key: '012',
                    value: '0',
                    scopedSlots: { title: 'title' },
                    title: '西成药'
                  },
                  {
                    key: '013',
                    value: '0',
                    scopedSlots: { title: 'title' },
                    title: '中草药',
                    children: [
                      {
                        key: '0131',
                        value: '0',
                        scopedSlots: { title: 'title' },
                        title: '中药饮片'
                      },
                      {
                        key: '0132',
                        value: '0',
                        scopedSlots: { title: 'title' },
                        title: '防病补虚药'
                      }
                    ]
                  }
                ]
              },
              {
                key: '02',
                value: '0',
                type: '2',
                scopedSlots: { title: 'title' },
                title: '通用'
              }
            ]
          },
          {
            key: '1',
            value: '1',
            scopedSlots: { title: 'title' },
            title: '自定义规则',
            children: [
              {
                key: '11',
                value: '1',
                type: '1',
                scopedSlots: { title: 'title' },
                title: '药品',
                children: [
                  {
                    key: '111',
                    value: '1',
                    type: '1',
                    scopedSlots: { title: 'title' },
                    title: '中成药'
                  },
                  {
                    key: '112',
                    value: '1',
                    type: '1',
                    scopedSlots: { title: 'title' },
                    title: '西成药'
                  },
                  {
                    key: '113',
                    value: '1',
                    type: '1',
                    scopedSlots: { title: 'title' },
                    title: '中草药',
                    children: [
                      {
                        key: '1131',
                        value: '1',
                        type: '1',
                        scopedSlots: { title: 'title' },
                        title: '中药饮片'
                      },
                      {
                        key: '1132',
                        value: '1',
                        type: '1',
                        scopedSlots: { title: 'title' },
                        title: '防病补虚药'
                      }
                    ]
                  }
                ]
              },
              {
                key: '12',
                value: '1',
                type: '2',
                scopedSlots: { title: 'title' },
                title: '通用'
              }
            ]
          }
        ],
        dataList: [],
        loading: false,
        loadData: [{ rule: '1', type: '1', drugName: '剂型与给药途径匹配性', status: '3', time: '2015-01-01 12:00' }],
        columns: [{ title: '药品名称', prop: 'drugName' },
          { title: '商品名', prop: 'type' },
          { title: '生产厂商', prop: 'ruleName' },
          { title: '剂型', prop: 'sss', align: 'center' },
          { title: '药品类型', prop: 'time' },
          { title: '状态', prop: 'status', align: 'center' },
          { title: '操作', prop: 'action', align: 'center' }
        ],
        //药品数据和表格title
        drugData: [
          { drugId: '123456', drugName: '阿司匹林', dosage: '颗粒', manufacturer: '肛泰制药' }
        ],
        column2: [{ title: '药品编码', prop: 'drugId', width: 100 },
          { title: '药品名称', prop: 'drugName' },
          { title: '剂型', prop: 'dosage', width: 70 },
          { title: '生成厂家', prop: 'manufacturer', width: 100 }],

        confirmLoading: false,
        total: 10,
        pageSize: 10,
        visible: false,
        values: '',
        selectNode: '',
        disable: true,
        Modal: {
          modalTitle: '新增分类',
          visible: false,
          confirmLoading: false
        },
        drugModal: {
          visible: false,
          confirmLoading: false
        },
        form: this.$form.createForm(this),
        selkeys: null
      }
    },
    mounted() {
      this.getgData()
    },
    computed: {
      list() {
        return [
          {
            name: '药品名称',
            dataField: 'drugName',
            type: 'text'
          },
          { name: '生产厂商', dataField: 'drugName', type: 'select' }

        ]
      }
    },
    methods: {
      //搜索
      search() {
        let params = this.$refs.searchPanel.form.getFieldsValue()
        params.pageSize = 10
        params.offset = 0
        // this.fetchYJSMapData(params)
      },
      //重置
      resetForm() {
        this.$refs.searchPanel.form.resetFields()
        // this.fetchYJSMapData({ pageSize: 10, offset: 0 })
      },

      //查询按下回车的回调
      pressEnterChange(e) {
        this.searchRule()
      },
      //查询
      searchRule() {
        const expandedKeys = this.dataList.map((item) => {
          if (this.values) {
            if (item.title.indexOf(this.values) > -1) {
              return this.getParentKey(item.title, this.gData)
            }
          }
          return null
        }).filter((item, i, self) => item && self.indexOf(item) === i)
        Object.assign(this, {
          expandedKeys,
          searchValue: this.values,
          autoExpandParent: true
        })
      },
      //输入框值改变事件
      onChange(e) {
        this.values = e.target.value
      },
      //树形节点点击事件
      onSelect(selectedKeys, e) {
        this.selkeys = selectedKeys
        this.selectNode = e.node.dataRef
        if (e.node.dataRef.value == '0' || (e.node.dataRef.value == '1' && e.node.dataRef.type != '1')) {
          this.disable = true
        } else {
          this.disable = false
        }
      },
      //树形节点展开事件
      onExpand(expandedKeys) {
        this.expandedKeys = expandedKeys
        this.autoExpandParent = false
      },
      generateList(data) {

        for (let i = 0; i < data.length; i++) {
          const node = data[i]

          const key = node.key
          const title = node.title
          this.dataList.push({ key, title: title })
          if (node.children) {
            this.generateList(node.children, node.title)
          }
        }
      },
      getParentKey(title, tree) {
        let parentKey
        for (let i = 0; i < tree.length; i++) {
          const node = tree[i]
          if (node.children) {
            if (node.children.some(item => item.title === title)) {
              parentKey = node.key
            } else if (this.getParentKey(title, node.children)) {
              parentKey = this.getParentKey(title, node.children)
            }
          }
        }
        return parentKey
      },
      //获取树形结构数据
      getgData() {
        this.generateList(this.gData)
      },


      //页面数change事件
      pageChangeSize() {

      },
      //页面跳转事件
      pageChange() {

      },

      //新增树节点
      newTreeNode() {
        if (this.selectNode) {
          this.Modal.modalTitle = '新增分类'
          this.Modal.visible = true
        } else {
          this.warn('请选择规则')
        }
      },
      updateTreeNode() {
        setTimeout(() => {
          this.form.setFieldsValue({ title: this.selectNode.title })
        }, 100)
        if (this.selectNode) {
          this.Modal.modalTitle = '编辑分类'
          this.Modal.visible = true
        } else {
          this.warn('请选择规则')
        }
      },
      deleteTreeNode() {
        if (this.selectNode) {
        } else {
          this.warn('请选择规则')
        }
      },
      handleOk() {
        console.log(this.selkeys, 'this.selkeys')
        console.log(this.selectNode, 'this.selectNode')
        let data = this.form.getFieldsValue()
        this.Modal.visible = false
      },
      handleCancel() {
        this.Modal.visible = false
      },

      addMdc() {
        if (!this.disable) {
          this.drugModal.visible = true
        } else {
          this.warn('请选择规则')
        }
      },
      edits(data) {
        this.$router.push({
          name: 'drugSpecDetail'
        })
      },
      drugOk() {
        this.drugModal.visible = false
      },
      drugCancel() {
        this.drugModal.visible = false
      },

      searchDrug(e) {
        console.log(e.target.value)
      },

      //filter
      ruleType(value) {
        if (value == '1') {
          return '系统'
        } else if (value == '2') {
          return '自定义'
        }
      },
      typeType(value) {
        if (value == '1') {
          return '药品规则'
        } else if (value == '2') {
          return '分类规则'
        } else if (value == '3') {
          return '分组规则'
        } else if (value == '4') {
          return '通用规则'
        }
      }
    }
  }
</script>

<style>
  .drugDetail .fontSize {
    font-size: 24px;

  }
  .drugDetail .font-bold{
    text-align: justify;
  }
  w2{
    letter-spacing:2em; /*如果需要y个字两端对齐，则为(x-y)/(y-1),这里是（4-2）/(2-1)=2em */
    padding-right:-2em; /*同上*/
  }
  .w3{
    letter-spacing:0.5em; /*如果需要y个字两端对齐，则为(x-y)/(y-1),这里是（4-3）/(3-1)=0.5em */
    padding-right:-0.5em; /*同上*/
  }

</style>